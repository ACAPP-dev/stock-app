{"ast":null,"code":"function fetchCompany(formData) {\n  // from to in stock data is unix time from 6/1/20 to 6/15/20\n  // const FINNHUB_STOCK_DATA_URL = 'https://finnhub.io/api/v1/stock/candle?symbol=AAPL&resolution=D&from=1590969600&to=1592179200&token=bsfleivrh5rf14r5rh80'\n  const FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1';\n  const FINNHUB_QUOTE_URL = '/quote?symbol=';\n  const FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol=';\n  const FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol=';\n  const FINNHUB_CHART_URL = '/stock/candle?symbol=';\n  const FINNHUB_CHART_TIMEFRAME = '&resolution=D&from=';\n  const FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80';\n  const chartStartDate = (Date.parse(formData.startDate) / 1000).toString();\n  const chartEndDate = (Date.parse(formData.endDate) / 1000).toString();\n  let finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate;\n  let companyData = {};\n  let quoteData = {};\n  let basicData = {};\n  let newChartData = [];\n  return dispatch => {\n    dispatch({\n      type: 'START_COMPANY_FETCH'\n    }); // Get company, stock, and chart data from API (3 fetches)\n\n    fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + formData.ticker + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n      companyData = json;\n      return fetchQuoteData();\n    });\n\n    const fetchQuoteData = () => {\n      fetch(FINNHUB_BASIC_URL + FINNHUB_QUOTE_URL + formData.ticker + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n        quoteData = json;\n        return fetchBasicData();\n      });\n    };\n\n    const fetchBasicData = () => {\n      fetch(FINNHUB_BASIC_URL + FINNHUB_BASIC_DATA_URL + formData.ticker + '&metric=price' + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n        basicData = json.metric;\n        return fetchChartData();\n      });\n    };\n\n    const fetchChartData = () => {\n      fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + formData.ticker + finnhubTimeframeUrl + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n        console.log('chart data: ', json);\n        newChartData = readyChartData(json);\n        return databaseFetch();\n      });\n    };\n\n    const databaseFetch = () => {\n      // Persist company and chart data to database\n      const companyDataObject = {\n        data: {\n          ticker: companyData.ticker,\n          name: companyData.name,\n          country: companyData.country,\n          exchange: companyData.exchange,\n          market_cap: companyData.marketCapitalization,\n          outstanding_shares: companyData.shareOutstanding,\n          web_url: companyData.weburl,\n          logo: companyData.logo,\n          industry: companyData.finnhubIndustry,\n          current_price: quoteData.c,\n          previous_close_price: quoteData.pc,\n          three_month_trading_volume: basicData['3MonthAverageTradingVolume'],\n          fifty_two_week_high: basicData['52WeekHigh'],\n          fifty_two_week_high_date: basicData['52WeekHighDate'],\n          fifty_two_week_low: basicData['52WeekLow'],\n          fifty_two_week_low_date: basicData['52WeekLowDate']\n        },\n        chartStartDate: chartStartDate,\n        chartEndDate: chartEndDate,\n        chartData: newChartData\n      };\n      const companyObject = {\n        method: 'POST',\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\"\n        },\n        body: JSON.stringify(companyDataObject)\n      };\n      fetch('http://localhost:3000/companies', companyObject).then(resp => resp.json()).then(json => {\n        return dispatch({\n          type: 'ADD_COMPANY',\n          payload: json\n        });\n      });\n    };\n  };\n} // Convert chart data from API fetch to a format that can persist to the database and work with the chart library\n// Add volume to model later?\n\n\nconst readyChartData = chartData => {\n  debugger;\n  const newChartData = [];\n\n  if (chartData.length > 0) {\n    chartData.t.map((date, index) => {\n      return newChartData.push({\n        date: date,\n        open: chartData.o[index],\n        high: chartData.h[index],\n        low: chartData.l[index],\n        close: chartData.c[index]\n      });\n    });\n  }\n\n  return newChartData;\n}; // Example of chart data format: \n//  newChart.data = [ {\n//     \"date\": \"2018-08-01\",\n//     \"open\": \"136.65\",\n//     \"high\": \"136.96\",\n//     \"low\": \"134.15\",\n//     \"close\": \"136.49\"\n//   },\n\n\nexport default fetchCompany;","map":{"version":3,"sources":["/Users/acapp5K1/Desktop/stocks-app/frontend/src/actions/fetchCompany.js"],"names":["fetchCompany","formData","FINNHUB_BASIC_URL","FINNHUB_QUOTE_URL","FINNHUB_COMPANY_DATA_URL","FINNHUB_BASIC_DATA_URL","FINNHUB_CHART_URL","FINNHUB_CHART_TIMEFRAME","FINNHUB_API_KEY","chartStartDate","Date","parse","startDate","toString","chartEndDate","endDate","finnhubTimeframeUrl","companyData","quoteData","basicData","newChartData","dispatch","type","fetch","ticker","then","resp","json","fetchQuoteData","fetchBasicData","metric","fetchChartData","console","log","readyChartData","databaseFetch","companyDataObject","data","name","country","exchange","market_cap","marketCapitalization","outstanding_shares","shareOutstanding","web_url","weburl","logo","industry","finnhubIndustry","current_price","c","previous_close_price","pc","three_month_trading_volume","fifty_two_week_high","fifty_two_week_high_date","fifty_two_week_low","fifty_two_week_low_date","chartData","companyObject","method","headers","body","JSON","stringify","payload","length","t","map","date","index","push","open","o","high","h","low","l","close"],"mappings":"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","sourcesContent":["function fetchCompany(formData) {\n    \n  // from to in stock data is unix time from 6/1/20 to 6/15/20\n// const FINNHUB_STOCK_DATA_URL = 'https://finnhub.io/api/v1/stock/candle?symbol=AAPL&resolution=D&from=1590969600&to=1592179200&token=bsfleivrh5rf14r5rh80'\nconst FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1'\nconst FINNHUB_QUOTE_URL = '/quote?symbol='\nconst FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol='\nconst FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol='\nconst FINNHUB_CHART_URL = '/stock/candle?symbol='\nconst FINNHUB_CHART_TIMEFRAME = '&resolution=D&from='\nconst FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80'\nconst chartStartDate = (Date.parse(formData.startDate)/1000).toString()\n\nconst chartEndDate = (Date.parse(formData.endDate)/1000).toString()\nlet finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate\nlet companyData = {}\nlet quoteData = {}\nlet basicData = {}\nlet newChartData = []\n\n    return dispatch => {\n        dispatch({ type: 'START_COMPANY_FETCH'})\n        \n        // Get company, stock, and chart data from API (3 fetches)\n\n        fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + formData.ticker + FINNHUB_API_KEY)\n        .then(resp => resp.json())\n        .then(json => {\n            companyData = json\n            return fetchQuoteData()\n        })\n\n        const fetchQuoteData = () => {\n            fetch(FINNHUB_BASIC_URL + FINNHUB_QUOTE_URL + formData.ticker + FINNHUB_API_KEY)\n            .then(resp => resp.json())\n            .then(json => {\n                quoteData = json\n                return fetchBasicData()\n            })\n        }\n\n        const fetchBasicData = () => {\n            fetch(FINNHUB_BASIC_URL + FINNHUB_BASIC_DATA_URL + formData.ticker + '&metric=price' + FINNHUB_API_KEY)\n            .then(resp => resp.json())\n            .then(json => {\n                basicData = json.metric\n                return fetchChartData()\n            })\n        }\n\n        const fetchChartData = () => {\n            fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + formData.ticker + finnhubTimeframeUrl + FINNHUB_API_KEY)\n            .then(resp => resp.json())\n            .then(json => {\n                console.log('chart data: ', json)\n                newChartData = readyChartData(json)\n                return databaseFetch()\n            })\n\n        }\n\n        const databaseFetch = () => {\n            // Persist company and chart data to database\n\n            const companyDataObject = {\n                data: {\n                    ticker: companyData.ticker,\n                    name: companyData.name,\n                    country: companyData.country,\n                    exchange: companyData.exchange,\n                    market_cap: companyData.marketCapitalization,\n                    outstanding_shares: companyData.shareOutstanding,\n                    web_url: companyData.weburl,\n                    logo: companyData.logo,\n                    industry: companyData.finnhubIndustry,\n                    current_price: quoteData.c,\n                    previous_close_price: quoteData.pc,\n                    three_month_trading_volume: basicData['3MonthAverageTradingVolume'],\n                    fifty_two_week_high: basicData['52WeekHigh'],\n                    fifty_two_week_high_date: basicData['52WeekHighDate'],\n                    fifty_two_week_low: basicData['52WeekLow'],\n                    fifty_two_week_low_date: basicData['52WeekLowDate']\n                },\n                chartStartDate: chartStartDate,\n                chartEndDate: chartEndDate,\n                chartData: newChartData\n            }\n        \n            const companyObject = {\n                method: 'POST',\n                headers: {\"Content-Type\": \"application/json\", \"Accept\": \"application/json\"},\n                body: JSON.stringify(companyDataObject)\n            }\n\n            fetch('http://localhost:3000/companies', companyObject)\n            .then(resp => resp.json())\n            .then(json => {\n                return dispatch({type: 'ADD_COMPANY', payload: json})\n            })\n        }\n    }\n}\n\n// Convert chart data from API fetch to a format that can persist to the database and work with the chart library\n// Add volume to model later?\nconst readyChartData = (chartData) => {\n    debugger\n    const newChartData = []\n    if (chartData.length > 0) {\n        chartData.t.map( (date, index) => {\n            return newChartData.push(\n                {date: date,\n                open: chartData.o[index],\n                high: chartData.h[index],\n                low: chartData.l[index],\n                close: chartData.c[index]\n                }\n            )\n        })\n    }\n\n    return newChartData\n}\n// Example of chart data format: \n//  newChart.data = [ {\n//     \"date\": \"2018-08-01\",\n//     \"open\": \"136.65\",\n//     \"high\": \"136.96\",\n//     \"low\": \"134.15\",\n//     \"close\": \"136.49\"\n//   },\n\nexport default fetchCompany"]},"metadata":{},"sourceType":"module"}