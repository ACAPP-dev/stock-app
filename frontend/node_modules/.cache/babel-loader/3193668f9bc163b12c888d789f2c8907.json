{"ast":null,"code":"function getDailyData(formData, watchlistObj, userId) {\n  console.log('formdata from getDailyData: ', formData); // !!!Need to iterate through watchlistObj.companies for company fetches...\n\n  const FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1';\n  const FINNHUB_QUOTE_URL = '/quote?symbol=';\n  const FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol=';\n  const FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol=';\n  const FINNHUB_CHART_URL = '/stock/candle?symbol=';\n  const FINNHUB_CHART_TIMEFRAME = '&resolution=D&from=';\n  const FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80';\n  const chartStartDate = (Date.parse(formData.startDate) / 1000).toString();\n  const chartEndDate = (Date.parse(formData.endDate) / 1000).toString();\n  let finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate;\n  const dailyDataArry = [];\n\n  const readyChartData = chartData => {\n    // const newChartData = []\n    return chartData.t.map((date, index) => {\n      return {\n        date: date,\n        open: chartData.o[index],\n        high: chartData.h[index],\n        low: chartData.l[index],\n        close: chartData.c[index]\n      };\n    }); // return newChartData\n  };\n\n  return dispatch => {\n    const databaseFetch = () => {\n      // Persist company and chart data to database\n      const companyObject = {\n        method: 'POST',\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\"\n        },\n        body: JSON.stringify({\n          userId: userId,\n          watchlistId: formData.watchlistId,\n          data: dailyDataArry\n        })\n      };\n      fetch('http://localhost:3000/daily', companyObject).then(resp => resp.json()).then(json => {\n        console.log('add daily data database response: ', json);\n        return dispatch({\n          type: 'ADD_DAILY_DATA',\n          payload: json\n        });\n      });\n    };\n\n    dispatch({\n      type: 'START_GET_DAILY_DATA'\n    });\n\n    const fetchData = ticker => {\n      //    debugger\n      // Get company, stock, and chart data from API (3 fetches)\n      fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + ticker + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n        // companyData = json\n        // debugger\n        console.log('companydata in getdailydata: ', json);\n        return json;\n      });\n\n      const fetchChartData = companyData => {\n        fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + ticker + finnhubTimeframeUrl + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n          console.log('chart data: ', json); // newChartData = readyChartData(json)\n\n          debugger;\n          return makeObj(companyData, readyChartData(json)); // if (index > watchlistObj.companies.length-1) {\n          //     return databaseFetch()\n          // }\n        });\n      };\n\n      const makeObj = (companyData, chartData) => {\n        const companyDataObject = {\n          [companyData.name]: {\n            ticker: companyData.ticker,\n            name: companyData.name,\n            country: companyData.country,\n            exchange: companyData.exchange,\n            market_cap: companyData.marketCapitalization,\n            outstanding_shares: companyData.shareOutstanding,\n            web_url: companyData.weburl,\n            logo: companyData.logo,\n            industry: companyData.finnhubIndustry\n          },\n          chartStartDate: chartStartDate,\n          chartEndDate: chartEndDate,\n          chartData: chartData\n        };\n      };\n    };\n\n    async function chainedFetchData(p, ticker) {\n      const companyObj = await p;\n      console.log(companyObj);\n      const companyData = await fetchData(ticker);\n      console.log(companyData);\n      debugger;\n      return { ...companyObj,\n        [ticker]: companyData\n      };\n    } // debugger\n\n\n    const dailyDataObject = watchlistObj.companies.map(company => company.ticker).reduce(chainedFetchData, Promise.resolve({})).then(console.log); // return watchlistObj.companies.reduce(company => fetchData(company), dailyDataArry)\n  };\n}\n\nexport default getDailyData;","map":{"version":3,"sources":["/Users/acapp5K1/Desktop/stocks-app/frontend/src/actions/getDailyData.js"],"names":["getDailyData","formData","watchlistObj","userId","console","log","FINNHUB_BASIC_URL","FINNHUB_QUOTE_URL","FINNHUB_COMPANY_DATA_URL","FINNHUB_BASIC_DATA_URL","FINNHUB_CHART_URL","FINNHUB_CHART_TIMEFRAME","FINNHUB_API_KEY","chartStartDate","Date","parse","startDate","toString","chartEndDate","endDate","finnhubTimeframeUrl","dailyDataArry","readyChartData","chartData","t","map","date","index","open","o","high","h","low","l","close","c","dispatch","databaseFetch","companyObject","method","headers","body","JSON","stringify","watchlistId","data","fetch","then","resp","json","type","payload","fetchData","ticker","fetchChartData","companyData","makeObj","companyDataObject","name","country","exchange","market_cap","marketCapitalization","outstanding_shares","shareOutstanding","web_url","weburl","logo","industry","finnhubIndustry","chainedFetchData","p","companyObj","dailyDataObject","companies","company","reduce","Promise","resolve"],"mappings":"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","sourcesContent":["function getDailyData(formData, watchlistObj, userId) {\n    console.log('formdata from getDailyData: ', formData)\n  \n      // !!!Need to iterate through watchlistObj.companies for company fetches...\n\n    const FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1'\n    const FINNHUB_QUOTE_URL = '/quote?symbol='\n    const FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol='\n    const FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol='\n    const FINNHUB_CHART_URL = '/stock/candle?symbol='\n    const FINNHUB_CHART_TIMEFRAME = '&resolution=D&from='\n    const FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80'\n    const chartStartDate = (Date.parse(formData.startDate)/1000).toString()\n    const chartEndDate = (Date.parse(formData.endDate)/1000).toString()\n    let finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate\n   \n    \n    const dailyDataArry = []\n\n    \n\n    const readyChartData = (chartData) => {\n        // const newChartData = []\n        \n        return chartData.t.map( (date, index) => {\n            return (\n                {date: date,\n                open: chartData.o[index],\n                high: chartData.h[index],\n                low: chartData.l[index],\n                close: chartData.c[index]\n                }\n            )\n        })\n        // return newChartData\n    }\n\n    \n\n    return dispatch => {\n\n        \n\n        const databaseFetch = () => {\n            // Persist company and chart data to database\n    \n            const companyObject = {\n                method: 'POST',\n                headers: {\"Content-Type\": \"application/json\", \"Accept\": \"application/json\"},\n                body: JSON.stringify({userId: userId, watchlistId: formData.watchlistId, data: dailyDataArry})\n            }\n    \n            fetch('http://localhost:3000/daily', companyObject)\n            .then(resp => resp.json())\n            .then(json => {\n                console.log('add daily data database response: ', json)\n                return dispatch({type: 'ADD_DAILY_DATA', payload: json})\n            })\n        }\n\n        dispatch({ type: 'START_GET_DAILY_DATA'})\n        \n        \n        const fetchData = ticker => {\n        //    debugger\n            // Get company, stock, and chart data from API (3 fetches)\n    \n                fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + ticker + FINNHUB_API_KEY)\n                .then(resp => resp.json())\n                .then(json => {\n                    // companyData = json\n                    // debugger\n                    console.log('companydata in getdailydata: ', json)\n                    return json\n                })\n\n                const fetchChartData = (companyData) => {\n                    fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + ticker + finnhubTimeframeUrl + FINNHUB_API_KEY)\n                    .then(resp => resp.json())\n                    .then(json => {\n                        console.log('chart data: ', json)\n                        // newChartData = readyChartData(json)\n                        debugger\n                        return makeObj(companyData, readyChartData(json))\n                        // if (index > watchlistObj.companies.length-1) {\n                        //     return databaseFetch()\n                            \n                        // }\n                    })\n                }\n        \n                \n                \n                const makeObj = (companyData, chartData) => {\n                    const companyDataObject = {\n                        [companyData.name]: {\n                            ticker: companyData.ticker,\n                            name: companyData.name,\n                            country: companyData.country,\n                            exchange: companyData.exchange,\n                            market_cap: companyData.marketCapitalization,\n                            outstanding_shares: companyData.shareOutstanding,\n                            web_url: companyData.weburl,\n                            logo: companyData.logo,\n                            industry: companyData.finnhubIndustry\n                            },\n                        chartStartDate: chartStartDate,\n                        chartEndDate: chartEndDate,\n                        chartData: chartData\n                    }\n                    \n                    \n                }\n        }\n\n        async function chainedFetchData(p, ticker) {\n            \n            const companyObj = await p\n            console.log(companyObj)\n\n            const companyData = await fetchData(ticker)\n            console.log(companyData)\n            debugger\n            return {...companyObj, [ticker]: companyData}\n    \n        }\n        // debugger\n        const dailyDataObject = watchlistObj.companies\n            .map(company => company.ticker)\n            .reduce(chainedFetchData, Promise.resolve({}))\n            .then(console.log)\n        // return watchlistObj.companies.reduce(company => fetchData(company), dailyDataArry)\n    \n        \n        \n        \n    }\n    \n}\n    export default getDailyData"]},"metadata":{},"sourceType":"module"}