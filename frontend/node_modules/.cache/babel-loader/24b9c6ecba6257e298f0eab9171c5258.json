{"ast":null,"code":"function getDailyData(formData, watchlistObj) {\n  console.log('formdata from getDailyData: ', formData); // !!!Need to iterate through watchlistObj.companies for company fetches...\n\n  const FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1';\n  const FINNHUB_QUOTE_URL = '/quote?symbol=';\n  const FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol=';\n  const FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol=';\n  const FINNHUB_CHART_URL = '/stock/candle?symbol=';\n  const FINNHUB_CHART_TIMEFRAME = '&resolution=D&from=';\n  const FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80';\n  const chartStartDate = (Date.parse(formData.startDate) / 1000).toString();\n  const chartEndDate = (Date.parse(formData.endDate) / 1000).toString();\n  let finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate;\n  let companyData = {};\n  let quoteData = {};\n  let basicData = {};\n  let newChartData = [];\n  const dailyDataArry = [];\n\n  const readyChartData = chartData => {\n    const newChartData = [];\n    chartData.t.map((date, index) => {\n      return newChartData.push({\n        date: date,\n        open: chartData.o[index],\n        high: chartData.h[index],\n        low: chartData.l[index],\n        close: chartData.c[index]\n      });\n    });\n    return newChartData;\n  };\n\n  const databaseFetch = () => {\n    // Persist company and chart data to database\n    const companyObject = {\n      method: 'POST',\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/json\"\n      },\n      body: JSON.stringify(dailyDataArry)\n    };\n    fetch('http://localhost:3000/daily', companyObject).then(resp => resp.json()).then(json => {\n      console.log('add daily data database response: ', json);\n      return dispatch({\n        type: 'ADD_DAILY_DATA',\n        payload: json\n      });\n    });\n  };\n\n  return dispatch => {\n    dispatch({\n      type: 'START_GET_DAILY_DATA'\n    });\n    return watchlistObj.companies.map((company, index) => {\n      //    debugger\n      // Get company, stock, and chart data from API (3 fetches)\n      fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + company.ticker + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n        companyData = json;\n        console.log('companydata in getdailydata: ', companyData);\n        return fetchChartData();\n      });\n\n      const fetchChartData = () => {\n        fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + company.ticker + finnhubTimeframeUrl + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n          console.log('chart data: ', json);\n          newChartData = readyChartData(json);\n          return makeObj();\n        });\n      };\n\n      const makeObj = () => {\n        const companyDataObject = {\n          data: {\n            ticker: companyData.ticker,\n            name: companyData.name,\n            country: companyData.country,\n            exchange: companyData.exchange,\n            market_cap: companyData.marketCapitalization,\n            outstanding_shares: companyData.shareOutstanding,\n            web_url: companyData.weburl,\n            logo: companyData.logo,\n            industry: companyData.finnhubIndustry\n          },\n          chartStartDate: chartStartDate,\n          chartEndDate: chartEndDate,\n          chartData: newChartData\n        };\n\n        if (index < watchlistObj.companies.length - 1) {\n          return dailyDataArry.push(companyDataObject);\n        } else {\n          dailyDataArry.push(companyDataObject);\n          return databaseFetch();\n        }\n      };\n    });\n  };\n}\n\nexport default getDailyData;","map":{"version":3,"sources":["/Users/acapp5K1/Desktop/stocks-app/frontend/src/actions/getDailyData.js"],"names":["getDailyData","formData","watchlistObj","console","log","FINNHUB_BASIC_URL","FINNHUB_QUOTE_URL","FINNHUB_COMPANY_DATA_URL","FINNHUB_BASIC_DATA_URL","FINNHUB_CHART_URL","FINNHUB_CHART_TIMEFRAME","FINNHUB_API_KEY","chartStartDate","Date","parse","startDate","toString","chartEndDate","endDate","finnhubTimeframeUrl","companyData","quoteData","basicData","newChartData","dailyDataArry","readyChartData","chartData","t","map","date","index","push","open","o","high","h","low","l","close","c","databaseFetch","companyObject","method","headers","body","JSON","stringify","fetch","then","resp","json","dispatch","type","payload","companies","company","ticker","fetchChartData","makeObj","companyDataObject","data","name","country","exchange","market_cap","marketCapitalization","outstanding_shares","shareOutstanding","web_url","weburl","logo","industry","finnhubIndustry","length"],"mappings":"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","sourcesContent":["function getDailyData(formData, watchlistObj) {\n    console.log('formdata from getDailyData: ', formData)\n  \n      // !!!Need to iterate through watchlistObj.companies for company fetches...\n\n    const FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1'\n    const FINNHUB_QUOTE_URL = '/quote?symbol='\n    const FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol='\n    const FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol='\n    const FINNHUB_CHART_URL = '/stock/candle?symbol='\n    const FINNHUB_CHART_TIMEFRAME = '&resolution=D&from='\n    const FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80'\n    const chartStartDate = (Date.parse(formData.startDate)/1000).toString()\n    const chartEndDate = (Date.parse(formData.endDate)/1000).toString()\n    let finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate\n    let companyData = {}\n    let quoteData = {}\n    let basicData = {}\n    let newChartData = []\n    \n    const dailyDataArry = []\n\n    \n\n    const readyChartData = (chartData) => {\n        const newChartData = []\n    \n        chartData.t.map( (date, index) => {\n            return newChartData.push(\n                {date: date,\n                open: chartData.o[index],\n                high: chartData.h[index],\n                low: chartData.l[index],\n                close: chartData.c[index]\n                }\n            )\n        })\n        return newChartData\n    }\n\n    const databaseFetch = () => {\n        // Persist company and chart data to database\n\n        const companyObject = {\n            method: 'POST',\n            headers: {\"Content-Type\": \"application/json\", \"Accept\": \"application/json\"},\n            body: JSON.stringify(dailyDataArry)\n        }\n\n        fetch('http://localhost:3000/daily', companyObject)\n        .then(resp => resp.json())\n        .then(json => {\n            console.log('add daily data database response: ', json)\n            return dispatch({type: 'ADD_DAILY_DATA', payload: json})\n        })\n    }\n    \n    return dispatch => {\n        dispatch({ type: 'START_GET_DAILY_DATA'})\n        \n\n        return watchlistObj.companies.map((company, index) => {\n        //    debugger\n            // Get company, stock, and chart data from API (3 fetches)\n    \n                fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + company.ticker + FINNHUB_API_KEY)\n                .then(resp => resp.json())\n                .then(json => {\n                    companyData = json\n                    console.log('companydata in getdailydata: ', companyData)\n                    return fetchChartData()\n                })\n\n                const fetchChartData = () => {\n                    fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + company.ticker + finnhubTimeframeUrl + FINNHUB_API_KEY)\n                    .then(resp => resp.json())\n                    .then(json => {\n                        console.log('chart data: ', json)\n                        newChartData = readyChartData(json)\n                        return makeObj()\n                    })\n                }\n        \n                const makeObj = () => {\n                    const companyDataObject = {\n                        data: {\n                            ticker: companyData.ticker,\n                            name: companyData.name,\n                            country: companyData.country,\n                            exchange: companyData.exchange,\n                            market_cap: companyData.marketCapitalization,\n                            outstanding_shares: companyData.shareOutstanding,\n                            web_url: companyData.weburl,\n                            logo: companyData.logo,\n                            industry: companyData.finnhubIndustry\n                            },\n                        chartStartDate: chartStartDate,\n                        chartEndDate: chartEndDate,\n                        chartData: newChartData\n                    }\n                    if (index < watchlistObj.companies.length-1) {\n                        return dailyDataArry.push(companyDataObject)\n                    } else {\n                        dailyDataArry.push(companyDataObject)\n                        return databaseFetch()\n                    }\n                }\n        })\n\n        \n    }\n\n}\n    export default getDailyData"]},"metadata":{},"sourceType":"module"}