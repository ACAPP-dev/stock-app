{"ast":null,"code":"function getDailyData(formData, watchlistObj) {\n  console.log('formdata from getDailyData: ', formData); // !!!Need to iterate through watchlistObj.companies for company fetches...\n\n  const FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1';\n  const FINNHUB_QUOTE_URL = '/quote?symbol=';\n  const FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol=';\n  const FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol=';\n  const FINNHUB_CHART_URL = '/stock/candle?symbol=';\n  const FINNHUB_CHART_TIMEFRAME = '&resolution=D&from=';\n  const FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80';\n  const chartStartDate = (Date.parse(formData.startDate) / 1000).toString();\n  const chartEndDate = (Date.parse(formData.endDate) / 1000).toString();\n  let finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate;\n  let companyData = {};\n  let quoteData = {};\n  let basicData = {};\n  let newChartData = [];\n  const dailyDataArry = [];\n  return dispatch => {\n    dispatch({\n      type: 'START_GET_DAILY_DATA'\n    });\n    watchlistObj.companies.map(company => {\n      // Get company, stock, and chart data from API (3 fetches)\n      fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + company.ticker + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n        companyData = json;\n        return fetchChartData();\n      });\n\n      const fetchChartData = () => {\n        fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + company.ticker + finnhubTimeframeUrl + FINNHUB_API_KEY).then(resp => resp.json()).then(json => {\n          console.log('chart data: ', json);\n          newChartData = readyChartData(json);\n        });\n      };\n\n      const companyDataObject = {\n        data: {\n          ticker: companyData.ticker,\n          name: companyData.name,\n          country: companyData.country,\n          exchange: companyData.exchange,\n          market_cap: companyData.marketCapitalization,\n          outstanding_shares: companyData.shareOutstanding,\n          web_url: companyData.weburl,\n          logo: companyData.logo,\n          industry: companyData.finnhubIndustry\n        },\n        chartStartDate: chartStartDate,\n        chartEndDate: chartEndDate,\n        chartData: newChartData\n      };\n      return watchlistObj.push(companyDataObject);\n    });\n    debugger; // return databaseFetch()\n\n    const databaseFetch = () => {\n      // Persist company and chart data to database\n      const companyObject = {\n        method: 'POST',\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Accept\": \"application/json\"\n        },\n        body: JSON.stringify(companyDataObject)\n      };\n      fetch('http://localhost:3000/daily', companyObject).then(resp => resp.json()).then(json => {\n        console.log('add daily data database response: ', json);\n        return dispatch({\n          type: 'ADD_DAILY_DATA',\n          payload: json\n        });\n      });\n    };\n  }; // Convert chart data from API fetch to a format that can persist to the database and work with the chart library\n  // Add volume to model later?\n\n  const readyChartData = chartData => {\n    const newChartData = [];\n    chartData.t.map((date, index) => {\n      return newChartData.push({\n        date: date,\n        open: chartData.o[index],\n        high: chartData.h[index],\n        low: chartData.l[index],\n        close: chartData.c[index]\n      });\n    });\n    return newChartData;\n  };\n}\n\nexport default getDailyData;","map":{"version":3,"sources":["/Users/acapp5K1/Desktop/stocks-app/frontend/src/actions/getDailyData.js"],"names":["getDailyData","formData","watchlistObj","console","log","FINNHUB_BASIC_URL","FINNHUB_QUOTE_URL","FINNHUB_COMPANY_DATA_URL","FINNHUB_BASIC_DATA_URL","FINNHUB_CHART_URL","FINNHUB_CHART_TIMEFRAME","FINNHUB_API_KEY","chartStartDate","Date","parse","startDate","toString","chartEndDate","endDate","finnhubTimeframeUrl","companyData","quoteData","basicData","newChartData","dailyDataArry","dispatch","type","companies","map","company","fetch","ticker","then","resp","json","fetchChartData","readyChartData","companyDataObject","data","name","country","exchange","market_cap","marketCapitalization","outstanding_shares","shareOutstanding","web_url","weburl","logo","industry","finnhubIndustry","chartData","push","databaseFetch","companyObject","method","headers","body","JSON","stringify","payload","t","date","index","open","o","high","h","low","l","close","c"],"mappings":"AAAA,SAASA,YAAT,CAAsBC,QAAtB,EAAgCC,YAAhC,EAA8C;AAC1CC,EAAAA,OAAO,CAACC,GAAR,CAAY,8BAAZ,EAA4CH,QAA5C,EAD0C,CAGxC;;AAEF,QAAMI,iBAAiB,GAAG,2BAA1B;AACA,QAAMC,iBAAiB,GAAG,gBAA1B;AACA,QAAMC,wBAAwB,GAAG,yBAAjC;AACA,QAAMC,sBAAsB,GAAG,uBAA/B;AACA,QAAMC,iBAAiB,GAAG,uBAA1B;AACA,QAAMC,uBAAuB,GAAG,qBAAhC;AACA,QAAMC,eAAe,GAAG,6BAAxB;AACA,QAAMC,cAAc,GAAG,CAACC,IAAI,CAACC,KAAL,CAAWb,QAAQ,CAACc,SAApB,IAA+B,IAAhC,EAAsCC,QAAtC,EAAvB;AACA,QAAMC,YAAY,GAAG,CAACJ,IAAI,CAACC,KAAL,CAAWb,QAAQ,CAACiB,OAApB,IAA6B,IAA9B,EAAoCF,QAApC,EAArB;AACA,MAAIG,mBAAmB,GAAGT,uBAAuB,GAAGE,cAA1B,GAA2C,MAA3C,GAAoDK,YAA9E;AACA,MAAIG,WAAW,GAAG,EAAlB;AACA,MAAIC,SAAS,GAAG,EAAhB;AACA,MAAIC,SAAS,GAAG,EAAhB;AACA,MAAIC,YAAY,GAAG,EAAnB;AAEA,QAAMC,aAAa,GAAG,EAAtB;AAEA,SAAOC,QAAQ,IAAI;AACfA,IAAAA,QAAQ,CAAC;AAAEC,MAAAA,IAAI,EAAE;AAAR,KAAD,CAAR;AAGAxB,IAAAA,YAAY,CAACyB,SAAb,CAAuBC,GAAvB,CAA2BC,OAAO,IAAI;AAElC;AAEAC,MAAAA,KAAK,CAACzB,iBAAiB,GAAGE,wBAApB,GAA+CsB,OAAO,CAACE,MAAvD,GAAgEpB,eAAjE,CAAL,CACCqB,IADD,CACMC,IAAI,IAAIA,IAAI,CAACC,IAAL,EADd,EAECF,IAFD,CAEME,IAAI,IAAI;AACVd,QAAAA,WAAW,GAAGc,IAAd;AACA,eAAOC,cAAc,EAArB;AACH,OALD;;AAOA,YAAMA,cAAc,GAAG,MAAM;AACzBL,QAAAA,KAAK,CAACzB,iBAAiB,GAAGI,iBAApB,GAAwCoB,OAAO,CAACE,MAAhD,GAAyDZ,mBAAzD,GAA+ER,eAAhF,CAAL,CACCqB,IADD,CACMC,IAAI,IAAIA,IAAI,CAACC,IAAL,EADd,EAECF,IAFD,CAEME,IAAI,IAAI;AACV/B,UAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA4B8B,IAA5B;AACAX,UAAAA,YAAY,GAAGa,cAAc,CAACF,IAAD,CAA7B;AAEH,SAND;AAOH,OARD;;AAWA,YAAMG,iBAAiB,GAAG;AACtBC,QAAAA,IAAI,EAAE;AACFP,UAAAA,MAAM,EAAEX,WAAW,CAACW,MADlB;AAEFQ,UAAAA,IAAI,EAAEnB,WAAW,CAACmB,IAFhB;AAGFC,UAAAA,OAAO,EAAEpB,WAAW,CAACoB,OAHnB;AAIFC,UAAAA,QAAQ,EAAErB,WAAW,CAACqB,QAJpB;AAKFC,UAAAA,UAAU,EAAEtB,WAAW,CAACuB,oBALtB;AAMFC,UAAAA,kBAAkB,EAAExB,WAAW,CAACyB,gBAN9B;AAOFC,UAAAA,OAAO,EAAE1B,WAAW,CAAC2B,MAPnB;AAQFC,UAAAA,IAAI,EAAE5B,WAAW,CAAC4B,IARhB;AASFC,UAAAA,QAAQ,EAAE7B,WAAW,CAAC8B;AATpB,SADgB;AAYtBtC,QAAAA,cAAc,EAAEA,cAZM;AAatBK,QAAAA,YAAY,EAAEA,YAbQ;AActBkC,QAAAA,SAAS,EAAE5B;AAdW,OAA1B;AAiBA,aAAOrB,YAAY,CAACkD,IAAb,CAAkBf,iBAAlB,CAAP;AACH,KAxCD;AAyCA,aA7Ce,CA8Cf;;AAMA,UAAMgB,aAAa,GAAG,MAAM;AACxB;AAIA,YAAMC,aAAa,GAAG;AAClBC,QAAAA,MAAM,EAAE,MADU;AAElBC,QAAAA,OAAO,EAAE;AAAC,0BAAgB,kBAAjB;AAAqC,oBAAU;AAA/C,SAFS;AAGlBC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAetB,iBAAf;AAHY,OAAtB;AAMAP,MAAAA,KAAK,CAAC,6BAAD,EAAgCwB,aAAhC,CAAL,CACCtB,IADD,CACMC,IAAI,IAAIA,IAAI,CAACC,IAAL,EADd,EAECF,IAFD,CAEME,IAAI,IAAI;AACV/B,QAAAA,OAAO,CAACC,GAAR,CAAY,oCAAZ,EAAkD8B,IAAlD;AACA,eAAOT,QAAQ,CAAC;AAACC,UAAAA,IAAI,EAAE,gBAAP;AAAyBkC,UAAAA,OAAO,EAAE1B;AAAlC,SAAD,CAAf;AACH,OALD;AAMH,KAjBD;AAkBH,GAtED,CAtB0C,CA+F1C;AACA;;AACA,QAAME,cAAc,GAAIe,SAAD,IAAe;AAClC,UAAM5B,YAAY,GAAG,EAArB;AAEA4B,IAAAA,SAAS,CAACU,CAAV,CAAYjC,GAAZ,CAAiB,CAACkC,IAAD,EAAOC,KAAP,KAAiB;AAC9B,aAAOxC,YAAY,CAAC6B,IAAb,CACH;AAACU,QAAAA,IAAI,EAAEA,IAAP;AACAE,QAAAA,IAAI,EAAEb,SAAS,CAACc,CAAV,CAAYF,KAAZ,CADN;AAEAG,QAAAA,IAAI,EAAEf,SAAS,CAACgB,CAAV,CAAYJ,KAAZ,CAFN;AAGAK,QAAAA,GAAG,EAAEjB,SAAS,CAACkB,CAAV,CAAYN,KAAZ,CAHL;AAIAO,QAAAA,KAAK,EAAEnB,SAAS,CAACoB,CAAV,CAAYR,KAAZ;AAJP,OADG,CAAP;AAQH,KATD;AAUA,WAAOxC,YAAP;AACH,GAdD;AAgBH;;AACG,eAAevB,YAAf","sourcesContent":["function getDailyData(formData, watchlistObj) {\n    console.log('formdata from getDailyData: ', formData)\n  \n      // !!!Need to iterate through watchlistObj.companies for company fetches...\n\n    const FINNHUB_BASIC_URL = 'https://finnhub.io/api/v1'\n    const FINNHUB_QUOTE_URL = '/quote?symbol='\n    const FINNHUB_COMPANY_DATA_URL = '/stock/profile2?symbol='\n    const FINNHUB_BASIC_DATA_URL = '/stock/metric?symbol='\n    const FINNHUB_CHART_URL = '/stock/candle?symbol='\n    const FINNHUB_CHART_TIMEFRAME = '&resolution=D&from='\n    const FINNHUB_API_KEY = '&token=bsfleivrh5rf14r5rh80'\n    const chartStartDate = (Date.parse(formData.startDate)/1000).toString()\n    const chartEndDate = (Date.parse(formData.endDate)/1000).toString()\n    let finnhubTimeframeUrl = FINNHUB_CHART_TIMEFRAME + chartStartDate + '&to=' + chartEndDate\n    let companyData = {}\n    let quoteData = {}\n    let basicData = {}\n    let newChartData = []\n\n    const dailyDataArry = []\n\n    return dispatch => {\n        dispatch({ type: 'START_GET_DAILY_DATA'})\n        \n\n        watchlistObj.companies.map(company => {\n\n            // Get company, stock, and chart data from API (3 fetches)\n    \n            fetch(FINNHUB_BASIC_URL + FINNHUB_COMPANY_DATA_URL + company.ticker + FINNHUB_API_KEY)\n            .then(resp => resp.json())\n            .then(json => {\n                companyData = json\n                return fetchChartData()\n            })\n\n            const fetchChartData = () => {\n                fetch(FINNHUB_BASIC_URL + FINNHUB_CHART_URL + company.ticker + finnhubTimeframeUrl + FINNHUB_API_KEY)\n                .then(resp => resp.json())\n                .then(json => {\n                    console.log('chart data: ', json)\n                    newChartData = readyChartData(json)\n                    \n                })\n            }\n        \n\n            const companyDataObject = {\n                data: {\n                    ticker: companyData.ticker,\n                    name: companyData.name,\n                    country: companyData.country,\n                    exchange: companyData.exchange,\n                    market_cap: companyData.marketCapitalization,\n                    outstanding_shares: companyData.shareOutstanding,\n                    web_url: companyData.weburl,\n                    logo: companyData.logo,\n                    industry: companyData.finnhubIndustry\n                    },\n                chartStartDate: chartStartDate,\n                chartEndDate: chartEndDate,\n                chartData: newChartData\n            }\n\n            return watchlistObj.push(companyDataObject)\n        })\n        debugger\n        // return databaseFetch()\n    \n    \n\n\n\n        const databaseFetch = () => {\n            // Persist company and chart data to database\n\n            \n        \n            const companyObject = {\n                method: 'POST',\n                headers: {\"Content-Type\": \"application/json\", \"Accept\": \"application/json\"},\n                body: JSON.stringify(companyDataObject)\n            }\n\n            fetch('http://localhost:3000/daily', companyObject)\n            .then(resp => resp.json())\n            .then(json => {\n                console.log('add daily data database response: ', json)\n                return dispatch({type: 'ADD_DAILY_DATA', payload: json})\n            })\n        }\n    }\n\n    \n    // Convert chart data from API fetch to a format that can persist to the database and work with the chart library\n    // Add volume to model later?\n    const readyChartData = (chartData) => {\n        const newChartData = []\n    \n        chartData.t.map( (date, index) => {\n            return newChartData.push(\n                {date: date,\n                open: chartData.o[index],\n                high: chartData.h[index],\n                low: chartData.l[index],\n                close: chartData.c[index]\n                }\n            )\n        })\n        return newChartData\n    }\n    \n}\n    export default getDailyData"]},"metadata":{},"sourceType":"module"}